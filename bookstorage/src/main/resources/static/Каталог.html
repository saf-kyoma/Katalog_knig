<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <title>Каталог</title>
  <!-- Подключение Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="nicepage.css" media="screen">
  <link rel="stylesheet" href="index.css" media="screen">
  <script class="u-script" type="text/javascript" src="jquery.js" defer></script>
  <script class="u-script" type="text/javascript" src="nicepage.js" defer></script>
  <meta name="generator" content="Nicepage 7.1.0, nicepage.com">
  <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <meta name="theme-color" content="#2cccc4">
  <meta property="og:title" content="Каталог">
  <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">

</head>

<body data-home-page="Каталог.html" data-home-page-title="Каталог" data-path-to-root="./" data-include-products="true" class="u-body u-xl-mode" data-lang="ru">
<header class="u-header" id="sec-233d" data-animation-name="" data-animation-duration="0" data-animation-delay="0" data-animation-direction="">
  <div class="u-clearfix u-sheet u-valign-top u-sheet-1">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <nav class="u-dropdown-icon u-menu u-menu-dropdown u-menu-1" data-responsive-from="XS" data-submenu-level="on-click">
      <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px; font-weight: 500;">
        <a class="u-button-style u-custom-active-border-color u-custom-active-color u-custom-border u-custom-border-color u-custom-borders u-custom-hover-border-color u-custom-hover-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-decoration u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-hamburger-link u-nav-link u-hamburger-link-1" href="#">
          <svg class="u-svg-link" viewBox="0 0 24 24"><use xlink:href="#svg-d22a"></use></svg>
          <svg class="u-svg-content" version="1.1" id="svg-d22a" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
          </g></svg>
        </a>
      </div>
      <div class="u-custom-menu u-nav-container">
        <ul class="u-nav u-spacing-2 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-active-grey-5 u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-light-1 u-border-no-left u-border-no-right u-border-no-top u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="./" style="padding: 9px 6px;">Каталог</a>
        </li><li class="u-nav-item"><a class="u-active-grey-5 u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-light-1 u-border-no-left u-border-no-right u-border-no-top u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="Добавление-карточки-книги.html" style="padding: 9px 6px;">Добавление книги</a>
        </li><li class="u-nav-item"><a class="u-active-grey-5 u-border-2 u-border-active-palette-1-base u-border-hover-palette-1-light-1 u-border-no-left u-border-no-right u-border-no-top u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="#" style="padding: 9px 6px;">База данных</a><div class="u-nav-popup"><ul class="u-border-2 u-border-grey-5 u-nav u-unstyled u-v-spacing-5"><li class="u-nav-item"><a class="u-button-style u-nav-link u-white">Сохранить базу</a>
        </li><li class="u-nav-item"><a class="u-button-style u-nav-link u-white" href="#">Загрузить базу</a>
        </li></ul>
        </div>
        </li></ul>
      </div>
      <div class="u-custom-menu u-nav-container-collapse">
        <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
          <div class="u-inner-container-layout u-sidenav-overflow">
            <div class="u-menu-close"></div>
            <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-3"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="./">Каталог</a>
            </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Добавление-карточки-книги.html">Добавление книги</a>
            </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="#">База данных</a><div class="u-nav-popup"><ul class="u-border-2 u-border-grey-5 u-nav u-unstyled u-v-spacing-5"><li class="u-nav-item"><a class="u-button-style u-nav-link">Сохранить базу</a>
            </li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="#">Загрузить базу</a>
            </li></ul>
            </div>
            </li></ul>
          </div>
        </div>
        <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
      </div>
      <style class="menu-style">@media (max-width: 539px) {
                        [data-responsive-from="XS"] .u-nav-container {
                            display: none;
                        }
                        [data-responsive-from="XS"] .menu-collapse {
                            display: block;
                        }
                    }</style>
    </nav>
    <a href="#" class="u-border-none u-btn u-btn-round u-button-style u-hover-palette-1-light-1 u-palette-1-dark-2 u-radius u-btn-1">Поиск </a>
    <form action="#" class="u-border-1 u-border-grey-30 u-search u-search-left u-white u-search-1" data-search-token="no-license" data-href="search/search.html">
      <button class="u-search-button" type="submit">
                <span class="u-search-icon u-spacing-10">
                  <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 56.966 56.966"><use xlink:href="#svg-b9b6"></use></svg>
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-b9b6" x="0px" y="0px" viewBox="0 0 56.966 56.966" style="enable-background:new 0 0 56.966 56.966;" xml:space="preserve" class="u-svg-content"><path d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23
  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92
  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17
  s-17-7.626-17-17S14.61,6,23.984,6z"></path></svg>
                </span>
      </button>
      <input class="u-search-input" type="search" name="search" value="" placeholder="Введите название книги">
    </form>
  </div></header>
<section class="u-clearfix u-section-1" id="sec-25c7">
  <div class="u-expanded-width u-table u-table-responsive u-table-1">
    <table class="u-table-entity">
      <colgroup>
        <col width="16.66%">
        <col width="16.66%">
        <col width="16.66%">
        <col width="16.66%">
        <col width="16.66%">
        <col width="16.66%">
      </colgroup>
      <thead class="u-palette-4-base u-table-header u-table-header-1">
      <tr style="height: 43px;">
        <th>Название книги <button class="sort-button" data-column="name"></button></th>
        <th>Автор <button class="sort-button" data-column="author"></button></th>
        <th>Дата издания <button class="sort-button" data-column="publication_year"></button></th>
        <th>Издательство <button class="sort-button" data-column="publishing_company"></button></th>
        <th>Количество экземпляров <button class="sort-button" data-column="count_of_books"></button></th>
        <th>ISBN <button class="sort-button" data-column="isbn"></button></th>
      </tr>
      </thead>
      <tbody class="u-table-body u-table-body-1">
      <!-- Динамическое содержимое -->
      </tbody>
    </table>
  </div>
</section>

<footer class="u-align-center u-clearfix u-container-align-center u-footer u-grey-80 u-footer" id="sec-2f71">
  <div class="u-clearfix u-sheet u-sheet-1">
    <p class="u-small-text u-text u-text-variant u-text-1"> О вопросах и проблемах сообщать главному администратору или писать на почту GlobalMaster@book.com</p>
  </div>
</footer>
<section class="u-backlink u-clearfix u-grey-80">
  <p class="u-text">
    <span>This site was created with the </span>
    <a class="u-link" href="https://nicepage.com/" target="_blank" rel="nofollow">
      <span>Nicepage</span>
    </a>
  </p>
</section>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Пользовательский JavaScript для получения и отображения книг -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Функция для получения книг из API
    function fetchBooks() {
      fetch('/api/books')
        .then(response => {
          if (!response.ok) {
            throw new Error('Сетевая ошибка: ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          populateTable(data);
        })
        .catch(error => {
          console.error('Ошибка при выполнении запроса:', error);
        });
    }

    // Функция для заполнения таблицы данными о книгах
    function populateTable(books) {
      const tableBody = document.querySelector('.u-table-body-1');
      // Очистка существующих строк таблицы
      tableBody.innerHTML = '';

      books.forEach(book => {
        // Создание новой строки таблицы
        const row = document.createElement('tr');
        row.style.height = '28px';

        // Создание и заполнение ячеек

        // Название книги
        const nameCell = document.createElement('td');
        nameCell.className = 'u-border-1 u-border-grey-30 u-palette-4-light-3 u-table-cell';
        nameCell.textContent = book.name;
        row.appendChild(nameCell);

        // Жанр(-ы) - оставляем пустым согласно требованиям
        const genresCell = document.createElement('td');
        genresCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        genresCell.textContent = ''; // Пусто
        row.appendChild(genresCell);

        // Автор(-ы)
        const authorsCell = document.createElement('td');
        authorsCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        if (book.authors && book.authors.length > 0) {
          const authors = book.authors.map(author => author.fio).join(', ');
          authorsCell.textContent = authors;
        } else {
          authorsCell.textContent = 'Неизвестно';
        }
        row.appendChild(authorsCell);

        // Год издания
        const yearCell = document.createElement('td');
        yearCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        yearCell.textContent = book.publicationYear;
        row.appendChild(yearCell);

        // Издательство
        const publishingCell = document.createElement('td');
        publishingCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        publishingCell.textContent = book.publishingCompany;
        row.appendChild(publishingCell);

        // Число страниц - оставляем пустым согласно требованиям
        const pageCountCell = document.createElement('td');
        pageCountCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        pageCountCell.textContent = ''; // Пусто
        row.appendChild(pageCountCell);

        // Кол-во экземп.
        const countCell = document.createElement('td');
        countCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        countCell.textContent = book.countOfBooks;
        row.appendChild(countCell);

        // Язык - оставляем пустым согласно требованиям
        const languageCell = document.createElement('td');
        languageCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        languageCell.textContent = ''; // Пусто
        row.appendChild(languageCell);

        // ISBN
        const isbnCell = document.createElement('td');
        isbnCell.className = 'u-border-1 u-border-grey-30 u-table-cell';
        isbnCell.textContent = book.isbn;
        row.appendChild(isbnCell);

        // Добавление строки в тело таблицы
        tableBody.appendChild(row);
      });
    }
  ////////////////////СОРТИРОВКА
  const tableBody = document.querySelector('.u-table-body-1');

  // Функция для загрузки данных с сервера
  function fetchData(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    const apiUrl = `/api/books?${queryString}`;

    fetch(apiUrl)
      .then(response => {
        if (!response.ok) throw new Error('Ошибка загрузки данных');
        return response.json();
      })
      .then(data => populateTable(data))
      .catch(error => console.error('Ошибка:', error));
  }

  // Функция для заполнения таблицы данными
  function populateTable(data) {
    tableBody.innerHTML = '';

    data.forEach(book => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.name}</td>
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.authors}</td>
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.publication_year}</td>
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.publishing_company}</td>
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.count_of_books}</td>
        <td class="u-border-1 u-border-grey-30 u-table-cell">${book.isbn}</td>
      `;
      tableBody.appendChild(row);
    });
  }

  // Функция для обработки сортировки
  function handleSort(column, button) {
    const currentOrder = button.getAttribute('data-order') || 'asc';
    const newOrder = currentOrder === 'asc' ? 'desc' : 'asc';
    button.setAttribute('data-order', newOrder);
    button.textContent = newOrder === 'asc' ? '▲' : '▼';
    fetchData({ sort_column: column, sort_order: newOrder });
  }

  // Добавляем стрелки сортировки к заголовкам
  const tableHeaders = document.querySelectorAll('thead th');
  tableHeaders.forEach(header => {
    const columnName = header.textContent.trim().toLowerCase().replace(/\s+/g, '_');
    const sortButton = header.querySelector('.sort-button');

    // Устанавливаем начальное содержимое кнопки
    sortButton.textContent = '▲';

    // Убираем стандартные стили кнопки и устанавливаем собственные
    sortButton.style.background = 'none';
    sortButton.style.border = 'none';
    sortButton.style.padding = '0';
    sortButton.style.marginLeft = '5px';
    sortButton.style.cursor = 'pointer';
    sortButton.style.fontSize = '12px'; // Регулируйте размер по необходимости
    sortButton.style.userSelect = 'none';

    // Добавляем обработчик события клика
    sortButton.addEventListener('click', () => handleSort(columnName, sortButton));
  });

    // Вызов функции получения книг при загрузке страницы
    fetchBooks();
  });
</script>

</body></html>
