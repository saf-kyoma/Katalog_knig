<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <title>Редакт книг</title>
  <link rel="stylesheet" href="nicepage.css" media="screen">
  <link rel="stylesheet" href="Редакт-книги.css" media="screen">
  <script class="u-script" type="text/javascript" src="jquery.js" defer></script>
  <script class="u-script" type="text/javascript" src="nicepage.js" defer></script>
  <meta name="theme-color" content="#2cccc4">

  <style>
    .u-form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }

    .u-label {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: left;
    }

    .u-input {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .u-input-number {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }


    .suggestions-list {
      position: absolute;
      background-color: white;
      border: 1px solid #ccc;
      border-top: none;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      z-index: 1000;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .suggestions-list li {
      padding: 8px;
      cursor: pointer;
    }

    .suggestions-list li:hover {
      background-color: #f0f0f0;
    }

    .u-form-submit {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    /* Стили для тэга жанра */
    .tag {
      background-color: #3498db; /* Цвет фона тэга. Можно изменить по желанию */
      color: #ffffff;            /* Цвет текста внутри тэга */
      border-radius: 12px;       /* Закругление углов */
      padding: 5px 10px;         /* Внутренние отступы */
      margin: 2px;               /* Внешние отступы между тегами */
      display: inline-flex;      /* Выравнивание содержимого по центру */
      align-items: center;       /* Центрирование элементов по вертикали */
      font-size: 14px;           /* Размер шрифта */
      font-family: Arial, sans-serif; /* Семейство шрифтов */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Тень для объема */
      transition: background-color 0.3s ease; /* Плавное изменение цвета при наведении */
    }

    /* Стили для крестика удаления */
    .remove-tag {
      margin-left: 8px;         /* Отступ между текстом тэга и крестиком */
      cursor: pointer;          /* Курсор в виде указателя при наведении */
      font-weight: bold;        /* Жирность текста крестика */
      color: #ffffff;           /* Цвет крестика */
      transition: color 0.3s ease; /* Плавное изменение цвета при наведении */
    }

    .tags-input-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px;
      align-items: center;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .remove-tag {
      margin-left: 5px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      font-size: 14px;
    }

    .tag {
      background-color: #3498db;
      color: white;
      padding: 5px 10px;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
    }

    /* Эффект при наведении на тег */
    .tag:hover {
      background-color: #2980b9; /* Темнее цвет фона при наведении */
    }

    /* Эффект при наведении на крестик */
    .remove-tag:hover {
      color: #ff0000; /* Изменение цвета крестика на красный при наведении */
    }

    .u-sheet {
      max-width: 3000px; /* Ограничиваем ширину контента */
      margin: 0 auto; /* Центрируем контент */
      padding: 20px; /* Внутренний отступ */
    }

    .u-text-1 {
      text-align: center; /* Центрируем текст */
      margin-bottom: 20px; /* Отступ снизу */
      white-space: nowrap; /* Запрещаем перенос текста */
      overflow: hidden; /* Убираем прокрутку, если текст не помещается */
      text-overflow: ellipsis; /* Добавляем многоточие, если текст слишком длинный */
      display: inline-block; /* Гарантируем, что текст не растягивается */
      max-width: 100%; /* Ограничиваем ширину */
    }

    .u-form {
      display: flex;
      flex-direction: column;
      gap: 15px; /* Расстояние между элементами формы */
    }

    .buttons-container {
      display: flex; /* Используем флекс-бокс для выравнивания кнопок */
      justify-content: center; /* Центрируем кнопки горизонтально */
      align-items: center; /* Центрируем кнопки по вертикали */
      gap: 20px; /* Расстояние между кнопками */
      flex-wrap: nowrap; /* Запрещаем перенос кнопок на новую строку */
      margin-top: 20px; /* Отступ сверху */
    }

    .u-btn {
      flex: 0 0 auto; /* Кнопки сохраняют свои размеры и не растягиваются */
      min-width: 150px; /* Минимальная ширина кнопки */
      max-width: 200px; /* Максимальная ширина кнопки */
      text-align: center; /* Центрирование текста внутри кнопки */
      padding: 10px 20px; /* Внутренние отступы для кнопки */
    }



    @media (max-width: 768px) {
      .buttons-container {
        flex-direction: column; /* Кнопки располагаются вертикально на маленьких экранах */
      }

      .u-btn {
        width: 100%; /* Кнопки растягиваются на всю ширину контейнера */
        max-width: none; /* Снимаем ограничение ширины */
      }
    }

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }

    header {
        background-color: #2cccc4;
        color: #fff;
        padding: 10px 20px;
        text-align: center;
    }

    nav {
        background-color: #249a9a;
        padding: 10px;
    }

    nav ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
    }

    nav ul li {
        margin: 0 15px;
    }

    nav ul li a {
        color: white;
        text-decoration: none;
        font-weight: bold;
    }

    nav ul li a:hover {
        text-decoration: underline;
    }

    .container {
        margin: 20px auto;
        max-width: 800px;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }

    table th, table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        width: 25%; /* Каждая колонка равной ширины */
    }

    table th {
        background-color: #2cccc4;
        color: white;
        text-transform: uppercase;
    }

    table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .btn {
        display: inline-block;
        padding: 10px 15px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        background-color: #2cccc4;
        color: #fff;
        text-decoration: none;
        text-align: center;
    }

    .btn:hover {
        background-color: #249a9a;
    }


  </style>
</head>
<body class="u-body u-xl-mode" data-lang="ru">
<section class="u-clearfix u-section-1" id="sec-64ce">
  <div class="u-clearfix u-sheet u-sheet-1">
    <nav class="u-dropdown-icon u-menu u-menu-dropdown u-menu-1" data-responsive-from="XS" data-submenu-level="on-click">
      <ul>
        <li><a href="Каталог.html">Каталог</a></li>
        <li><a href="Добавление-карточки-книги.html">Добавление книги</a></li>
        <li><a href="Страница-авторов.html">Авторы</a></li>
        <li><a href="Страница-издательств.html">Издатели</a></li>
        <li><a href="Вход-в-систему.html">Войти</a></li>
      </ul>
      <style class="menu-style">@media (max-width: 539px) {
                        [data-responsive-from="XS"] .u-nav-container {
                            display: none;
                        }
                        [data-responsive-from="XS"] .menu-collapse {
                            display: block;
                        }
                    }</style>
    </nav>
    <h4 class="u-text u-text-1">Редактирование информации о книге</h4>
    <div class="u-form u-form-1">
      <form id="book-add-form" action="#" class="u-clearfix u-form-spacing-10 u-form-vertical u-inner-form">

        <div class="u-form-group">
          <label for="isbn" class="u-label">ISBN</label>
          <input
                  type="text"
                  id="isbn"
                  name="isbn"
                  class="u-input"
                  placeholder="000-0-00-000000-0"
                  maxlength="17"
                  title="Введите ISBN-13 в формате 000-0-00-000000-0"
                  required
          >
        </div>


        <div class="u-form-group">
          <label for="name-e75d" class="u-label">Название</label>
          <input type="text" placeholder="Введите название книги" id="name-e75d" name="name" class="u-input" required pattern="[A-Za-zА-Яа-я0-9\s\-]+" title="Разрешены только буквы, цифры, пробелы и дефис (-)">
        </div>

        <div class="u-form-group">
          <label for="date-13b1" class="u-label">Год</label>
          <input type="date" id="date-13b1" name="date" class="u-input-number" required>
        </div>

        <div class="u-form-group">
          <label for="age-limit" class="u-label">Возрастное ограничение</label>
          <select id="age-limit" name="age_limit" class="u-input" required>
            <option value="" disabled selected>Выберите возрастное ограничение</option>
            <option value="0+">0+</option>
            <option value="6+">6+</option>
            <option value="12+">12+</option>
            <option value="16+">16+</option>
            <option value="18+">18+</option>
          </select>
        </div>

        <div class="u-form-group">
          <label for="text-39ba" class="u-label">Издатель</label>
          <input type="text" placeholder="Введите издателя" id="text-39ba" name="publisher" class="u-input" required pattern="[A-Za-zА-Яа-я0-9\s\-]+" title="Разрешены только буквы, цифры, пробелы и дефис (-)">
        </div>

        <div class="u-form-group">
          <label for="number-1420" class="u-label">Страницы</label>
          <input type="number" id="number-1420" name="pages" class="u-input-number" value="0" min="1" max="10000" step="1" required>
        </div>



        <div class="u-form-group">
          <label for="language-select" class="u-label">Язык</label>
          <select id="language-select" name="language" class="u-input" required>
            <option value="" disabled selected>Выберите язык</option>
            <option value="Русский">Русский</option>
            <option value="Английский">Английский</option>
            <option value="Немецкий">Немецкий</option>
            <option value="Китайский">Китайский</option>
            <option value="Японский">Японский</option>
            <option value="Португальский">Португальский</option>
            <option value="Испанский">Испанский</option>
            <option value="Итальянский">Итальянский</option>
            <option value="Польский">Польский</option>
          </select>
        </div>

        <div class="u-form-group">
          <label for="price" class="u-label">Цена</label>
          <input type="number" id="price" name="price" class="u-input-number" min="0" step="0.01" required placeholder="Введите цену">
        </div>

        <div class="u-form-group">
          <label for="number-e44e" class="u-label">Кол-во</label>
          <input type="number" id="number-e44e" name="quantity" class="u-input-number" value="0" min="0" max="100" step="1" required>
        </div>

        <div class="u-form-group">
          <label for="author-e75d" class="u-label">Автор</label>
          <input type="text" placeholder="Введите автора" id="author-e75d" name="author" class="u-input" required pattern="[A-Za-zА-Яа-я0-9\s\-]+" title="Разрешены только буквы, цифры, пробелы и дефис (-)">
        </div>

        <!-- Поле Жанр -->
        <div class="u-form-group">
          <label for="genre-input" class="u-label">Жанры</label>
          <div class="tags-input-container">
            <div id="genre-tags" class="tags-container"></div>
            <input type="text" id="genre-input" class="u-input" placeholder="Введите жанр и нажмите Enter" required>
            <input type="hidden" id="genres-hidden" name="genres">
          </div>
        </div>


        <!-- Кнопки добавления и отмены -->
        <div class="u-form-group u-form-submit buttons-container">
          <button type="submit" class="u-btn u-btn-round u-btn-submit u-button-style u-radius u-btn-1">Редактировать</button>
          <a href="Каталог.html" class="u-btn u-btn-round u-button-style u-hover-palette-1-dark-1 u-palette-1-base u-radius u-btn-2">Отмена</a>
        </div>



        <!-- Сообщения об отправке -->
        <div class="u-form-send-message u-form-send-success"> Спасибо! Ваше сообщение отправлено. </div>
        <div class="u-form-send-error u-form-send-message"> Отправка не удалась. Пожалуйста, исправьте ошибки и попробуйте еще раз. </div>

        <!-- Скрытые поля -->
        <input type="hidden" value="" name="recaptchaResponse">
        <input type="hidden" name="formServices" value="234d2f51-51fe-7107-fa98-0d7a5e49113d">
      </form>
    </div>

  </div>
</section>

<!-- Подвал сайта -->
<footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-2f71">
  <div class="u-clearfix u-sheet u-sheet-1">
    <p class="u-small-text u-text u-text-variant u-text-1">
      О вопросах и проблемах сообщать главному администратору или писать на почту <a href="mailto:GlobalMaster@book.com">GlobalMaster@book.com</a>
    </p>
  </div>
</footer>

<!-- Скрипты валидации и функциональности -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Регулярное выражение для удаления нежелательных символов (разрешены буквы, цифры, пробелы, дефисы)
    const regex = /[^A-Za-zА-Яа-я0-9\s\-]/g;
    const fields = ['name-e75d', 'author-e75d', 'text-39ba'];

    // Добавляем обработчик события input для каждого поля
    fields.forEach(function(id) {
      const input = document.getElementById(id);
      if (input) { // Проверяем, существует ли элемент
        input.addEventListener('input', function() {
          this.value = this.value.replace(regex, '');
        });
      }
    });

    /////////////////////////////////////////////////////////////
    // Ограничение даты до текущего дня
    const today = new Date();
    const day = String(today.getDate()).padStart(2, '0');
    const month = String(today.getMonth() + 1).padStart(2, '0'); // Месяцы начинаются с 0
    const year = today.getFullYear();
    const formattedDate = `${year}-${month}-${day}`;

    const dateInput = document.getElementById('date-13b1');
    if (dateInput) {
      dateInput.setAttribute('max', formattedDate);
    }

    //////////////////////////////////////////////////////////////
    // Валидация ISBN-13
    const isbnInput = document.getElementById('isbn');

    function formatISBN(value) {
      let digits = value.replace(/\D/g, '');
      if (digits.length > 13) digits = digits.substring(0, 13);
      const parts = [];
      let index = 0;

      if (digits.length > 3) {
        parts.push(digits.substring(0, 3));
        index = 3;
      } else {
        parts.push(digits);
        return parts.join('-');
      }

      if (digits.length > 4) {
        parts.push(digits.substring(3, 4));
        index = 4;
      } else {
        parts.push(digits.substring(3));
        return parts.join('-');
      }

      if (digits.length > 6) {
        parts.push(digits.substring(4, 6));
        index = 6;
      } else {
        parts.push(digits.substring(4));
        return parts.join('-');
      }

      if (digits.length > 12) {
        parts.push(digits.substring(6, 12));
        index = 12;
      } else {
        parts.push(digits.substring(6));
        return parts.join('-');
      }

      if (digits.length > 12) {
        parts.push(digits.substring(12, 13));
      }

      return parts.join('-');
    }

    function onInputISBN(event) {
      const input = event.target;
      const formattedValue = formatISBN(input.value);
      input.value = formattedValue;
      input.setSelectionRange(input.value.length, input.value.length);
    }

    function restrictISBNInput(event) {
      const allowedKeys = ['Backspace', 'ArrowLeft', 'ArrowRight', 'Delete', 'Tab'];
      if (allowedKeys.includes(event.key)) return;
      if (!/^\d$/.test(event.key)) event.preventDefault();
    }

    if (isbnInput) {
      isbnInput.addEventListener('input', onInputISBN);
      isbnInput.addEventListener('keydown', restrictISBNInput);
    }

    const form = document.querySelector('form[name="bookForm"]');
    if (form && isbnInput) {
      form.addEventListener('submit', function(event) {
        const isbnValue = isbnInput.value.replace(/-/g, '').trim();
        if (isbnValue.length !== 13 || !isbnValue.startsWith('978')) {
          alert('ISBN должен содержать 13 цифр и начинаться с 978.');
          event.preventDefault();
          return;
        }
        let sum = 0;
        for (let i = 0; i < 12; i++) {
          const digit = parseInt(isbnValue[i], 10);
          if (isNaN(digit)) {
            alert('ISBN должен содержать только цифры.');
            event.preventDefault();
            return;
          }
          sum += (i % 2 === 0) ? digit : digit * 3;
        }
        const calculatedCheckDigit = (10 - (sum % 10)) % 10;
        const actualCheckDigit = parseInt(isbnValue[12], 10);
        if (isNaN(actualCheckDigit) || calculatedCheckDigit !== actualCheckDigit) {
          alert('Неверная контрольная цифра ISBN.');
          event.preventDefault();
        }
      });
    }

    /////////////////////////////////////////////////////////////


    /////////////////////////////////////////////////////////////
    // Валидация Жанра с Тэгами
    const genreInput = document.getElementById('genre-input');
    const genreTagsContainer = document.getElementById('genre-tags');
    const genresHiddenInput = document.getElementById('genres-hidden'); // Новое скрытое поле

    // Список доступных жанров
    const availableGenres = [
      'Фэнтези',
      'Триллер',
      'Комедия',
      'Драма',
      'Научная фантастика',
      'Романтика',
      'Ужасы',
      'Исторический',
      'Приключения',
      'Мистика'
      // Добавьте другие жанры по необходимости
    ];

    // Функция для создания тэга
  function createTag(text) {
    const tag = document.createElement('span');
    tag.classList.add('tag'); // Применяем класс 'tag'

    const tagText = document.createElement('span');
    tagText.textContent = text;

    const removeBtn = document.createElement('span');
    removeBtn.classList.add('remove-tag'); // Применяем класс 'remove-tag'
    removeBtn.textContent = '×'; // Крестик для удаления
    removeBtn.addEventListener('click', function() {
      genreTagsContainer.removeChild(tag);
      updateGenresHiddenInput();
    });

    tag.appendChild(tagText);
    tag.appendChild(removeBtn);
    genreTagsContainer.appendChild(tag);
    updateGenresHiddenInput(); // Обновляем скрытое поле при добавлении тэга
  }

  // Функция для обновления скрытого поля с жанрами
  function updateGenresHiddenInput() {
    const tags = Array.from(genreTagsContainer.children).map(tag => tag.firstChild.textContent);
    genresHiddenInput.value = tags.join(','); // Жанры разделены запятыми
  }

  // Разрешаем ввод только букв и пробелов
  genreInput.addEventListener('input', function() {
    this.value = this.value.replace(/[^A-Za-zА-Яа-яЁё\s]/g, '');
  });

  // Функция для фильтрации жанров для подсказок
  function filterGenres(query) {
    return availableGenres.filter(genre => genre.toLowerCase().includes(query.toLowerCase()) &&
      !Array.from(genreTagsContainer.children).some(tag => tag.firstChild.textContent.toLowerCase() === genre.toLowerCase()));
  }

  // Создание списка подсказок
  function createSuggestionsList(filteredGenres) {
    // Удаление предыдущих подсказок
    const existingList = document.getElementById('genre-suggestions');
    if (existingList) {
      existingList.remove();
    }

    if (filteredGenres.length === 0) return;

    const list = document.createElement('ul');
    list.id = 'genre-suggestions';
    list.classList.add('suggestions-list');

    filteredGenres.forEach(genre => {
      const listItem = document.createElement('li');
      listItem.textContent = genre;
      listItem.addEventListener('click', function() {
        createTag(genre);
        genreInput.value = '';
        list.remove();
      });
      list.appendChild(listItem);
    });

    genreInput.parentElement.appendChild(list);
  }

  // Обработчик ввода в поле жанра
  genreInput.addEventListener('input', function() {
    const query = this.value.trim();
    if (query.length === 0) {
      const existingList = document.getElementById('genre-suggestions');
      if (existingList) existingList.remove();
      return;
    }

    const filtered = filterGenres(query);
    createSuggestionsList(filtered);
  });

  // Закрытие подсказок при клике вне поля
  document.addEventListener('click', function (event) {
    if (!genreInput.contains(event.target) && !genreTagsContainer.contains(event.target)) {
      const existingList = document.getElementById('genre-suggestions');
      if (existingList) existingList.remove();
    }
  });


  ///////////////////////////
  //СКРЫТОЕ ПОЛЕ

  // Функция для обновления содержимого скрытого поля
  function updateHiddenInputAndRequired() {
    const genres = Array.from(genreTagsContainer.children).map(tag => tag.firstChild.textContent.trim());
    genresHiddenInput.value = genres.join(', '); // Обновляем скрытое поле
    genreInput.required = genres.length === 0; // Поле обязательно только если тегов нет
  }

  // Функция для создания тега
  function createTag(genre) {
    if (!genre.trim()) return;

    // Проверяем на дубли
    const existingGenres = Array.from(genreTagsContainer.children).map(tag => tag.firstChild.textContent.trim());
    if (existingGenres.includes(genre)) return;

    // Создаём тег
    const tag = document.createElement('span');
    tag.classList.add('tag');
    tag.textContent = genre;

    // Кнопка для удаления тега
    const removeBtn = document.createElement('span');
    removeBtn.classList.add('remove-tag');
    removeBtn.textContent = '×';
    removeBtn.addEventListener('click', function () {
      genreTagsContainer.removeChild(tag);
      updateHiddenInputAndRequired(); // Обновляем при удалении
    });

    tag.appendChild(removeBtn);
    genreTagsContainer.appendChild(tag);

    updateHiddenInputAndRequired(); // Обновляем скрытое поле и required
  }

  // Обработчик ввода жанра
  genreInput.addEventListener('keydown', function (event) {
    if (event.key === 'Enter' || event.key === ',') {
      event.preventDefault();
      const genre = genreInput.value.trim().replace(/,$/, '');
      if (!genre) return;

      createTag(genre); // Создаём тег
      genreInput.value = ''; // Очищаем поле ввода
    }
  });

  // При загрузке обновляем required
  updateHiddenInputAndRequired();
  //////////////////////////////////////////////////////

  // Обработка нажатия клавиши Enter для добавления жанра
  genreInput.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      const query = this.value.trim();
      if (availableGenres.includes(query) &&
          !Array.from(genreTagsContainer.children).some(tag => tag.firstChild.textContent.toLowerCase() === query.toLowerCase())) {
        createTag(query);
        this.value = '';
        const existingList = document.getElementById('genre-suggestions');
        if (existingList) existingList.remove();
      }
    }
    });
  });
</script>

</body>
</html>
