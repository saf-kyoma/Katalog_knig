<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Редактирование автора</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
    <link rel="stylesheet" href="Добавление-карточки-книги.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer></script>
    <meta name="theme-color" content="#2cccc4">
    <style>
        /* Основные стили формы */
        .u-form-group {
          display: flex;
          flex-direction: column;
          margin-bottom: 15px;
          position: relative;
        }
        .u-label {
          font-weight: bold;
          margin-bottom: 5px;
          text-align: left;
        }
        .u-input, .u-input-number, .u-select {
          width: 100%;
          padding: 8px;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 4px;
        }
        /* Стили для тегов жанров */
        .tags-input-container {
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
          border: 1px solid #ccc;
          border-radius: 4px;
          padding: 5px;
          align-items: center;
          position: relative;
        }
        .tags-container {
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
        }
        .tag {
          background-color: #3498db;
          color: white;
          padding: 5px 10px;
          border-radius: 12px;
          display: inline-flex;
          align-items: center;
          font-size: 14px;
          font-family: Arial, sans-serif;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          transition: background-color 0.3s ease;
        }
        .tag:hover {
          background-color: #2980b9;
        }
        .remove-tag {
          margin-left: 8px;
          cursor: pointer;
          font-weight: bold;
          color: #ffffff;
          transition: color 0.3s ease;
        }
        .remove-tag:hover {
          color: #ff0000;
        }
        /* Стили для списков подсказок */
        .suggestions-list {
          position: absolute;
          background-color: white;
          border: 1px solid #ccc;
          border-top: none;
          width: 100%;
          max-height: 150px;
          overflow-y: auto;
          z-index: 1000;
          list-style: none;
          padding: 0;
          margin: 0;
        }
        .suggestions-list li {
          padding: 8px;
          cursor: pointer;
        }
        .suggestions-list li:hover {
          background-color: #f0f0f0;
        }
        .author-suggestions-list {
          position: absolute;
          background-color: white;
          border: 1px solid #ccc;
          border-top: none;
          width: 100%;
          max-height: 150px;
          overflow-y: auto;
          z-index: 1000;
          list-style: none;
          padding: 0;
          margin: 0;
        }
        .author-suggestions-list li {
          padding: 8px;
          cursor: pointer;
        }
        .author-suggestions-list li:hover {
          background-color: #f0f0f0;
        }
        /* Стили для динамических групп авторов */
        .author-group {
          border: 1px solid #ccc;
          padding: 10px;
          border-radius: 4px;
          margin-bottom: 15px;
          position: relative;
        }
        .remove-author {
          position: absolute;
          top: 10px;
          right: 10px;
          cursor: pointer;
          color: red;
          font-weight: bold;
          display: none; /* Скрыто для первого автора */
          font-size: 18px;
          z-index: 1001;
        }
        .author-group:hover .remove-author {
          display: block;
        }
        .add-author-btn {
          padding: 8px 12px;
          background-color: #3498db;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
        .add-author-btn:hover {
          background-color: #2980b9;
        }
        /* Стили для кнопок */
        .buttons-container {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 20px;
        }
        .u-btn {
          flex: 0 1 auto;
          min-width: 120px;
          max-width: 200px;
          text-align: center;
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
        }
        .u-btn-submit {
          background-color: #2ecc71;
          color: white;
        }
        .u-btn-submit:hover {
          background-color: #27ae60;
        }
        .u-btn-cancel {
          background-color: #e74c3c;
          color: white;
          text-decoration: none;
          display: inline-block;
        }
        .u-btn-cancel:hover {
          background-color: #c0392b;
        }
        /* Стили для сообщений */
        .u-form-send-message {
          display: none;
          margin-top: 15px;
          padding: 10px;
          border-radius: 4px;
          text-align: center;
          font-weight: bold;
        }
        .u-form-send-success {
          background-color: #2ecc71;
          color: white;
        }
        .u-form-send-error {
          background-color: #e74c3c;
          color: white;
        }
        /* Стили для страницы */
        .u-sheet {
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
        }
        .u-text-1 {
          text-align: center;
          margin-bottom: 20px;
          font-size: 24px;
          font-weight: bold;
          writing-mode: horizontal-tb;
          transform: rotate(0deg);
        }
        /* Медиа-запросы для адаптивности */
        @media (max-width: 768px) {
          .buttons-container {
            flex-direction: column;
          }
          .u-btn {
            width: 100%;
            max-width: none;
          }
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #2cccc4;
            color: #fff;
            padding: 10px 20px;
            text-align: center;
        }
        nav {
            background-color: #249a9a;
            padding: 10px;
        }
        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }
        nav ul li {
            margin: 0 15px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        nav ul li a:hover {
            text-decoration: underline;
        }
        .container {
            margin: 20px auto;
            max-width: 800px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            width: 25%; /* Каждая колонка равной ширины */
        }
        table th {
            background-color: #2cccc4;
            color: white;
            text-transform: uppercase;
        }
        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn {
            display: inline-block;
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #2cccc4;
            color: #fff;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #249a9a;
        }
        .sort-button {
            background: none;
            border: none;
            padding: 0;
            margin-left: 5px;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }
        .sort-button:focus {
            outline: none;
        }
        footer {
            background-color: #f1f1f1;
            padding: 20px 0;
            text-align: center;
        }
        .u-backlink {
            background-color: #f1f1f1;
            padding: 10px 0;
            text-align: center;
        }
        /* Дополнительные стили для формы поиска и кнопок */
        .search-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .search-container .input-group {
            flex: 1 1 auto;
            min-width: 250px;
        }
        .search-buttons {
            display: flex;
            gap: 10px;
        }
        @media (max-width: 576px) {
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }
            .search-container .input-group,
            .search-buttons {
                width: 100%;
                justify-content: center;
            }
            .search-buttons {
                justify-content: flex-start;
            }
        }
        /* Стили для чекбоксов */
        .checkbox-column {
            text-align: center;
            width: 50px; /* Фиксированная ширина для чекбоксов */
        }
        .checkbox-column input[type="checkbox"] {
            transform: scale(1.2); /* Увеличение размера чекбокса для лучшей видимости */
        }
        /* Общий стиль навигации */
        nav.u-menu {
            background-color: #249a9a;
            display: flex;
            justify-content: center;
            padding: 10px;
        }
        nav.u-menu ul {
            list-style: none;
            display: flex;
            padding: 0;
            margin: 0;
        }
        nav.u-menu ul li {
            position: relative;
            margin: 0 10px;
        }
        nav.u-menu ul li a {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            display: block;
        }
        nav.u-menu ul li a:hover {
            background-color: #2cccc4;
            border-radius: 5px;
        }
        /* Стили для выпадающего меню */
        nav.u-menu .dropdown {
            position: relative;
        }
        nav.u-menu .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #fff;
            padding: 10px 0;
            list-style: none;
            margin: 0;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
            border-radius: 5px;
            z-index: 10;
        }
        nav.u-menu .dropdown-menu li {
            margin: 0;
        }
        nav.u-menu .dropdown-menu li a {
            color: #249a9a;
            padding: 10px 20px;
            display: block;
            text-align: left;
        }
        nav.u-menu .dropdown-menu li a:hover {
            background-color: #2cccc4;
            color: white;
        }
        /* Показываем меню при наведении */
        nav.u-menu .dropdown:hover .dropdown-menu {
            display: block;
        }
    </style>
</head>
<body class="u-body u-xl-mode" data-lang="ru">
<header>
    <h1>Редактирование информации об авторе</h1>
</header>
<nav class="u-dropdown-icon u-menu u-menu-dropdown u-menu-1 d-flex justify-content-center w-100" data-responsive-from="XS" data-submenu-level="on-click">
    <ul class="d-flex justify-content-center w-100">
        <li class="mx-2 flex-fill text-center"><a href="Каталог.html">Каталог</a></li>
        <li class="mx-2 flex-fill text-center"><a href="Страница-авторов.html">Авторы</a></li>
        <li class="mx-2 flex-fill text-center"><a href="Страница-издательств.html">Издательства</a></li>
        <li class="mx-2 flex-fill text-center"><a href="Вход-в-систему.html">Войти</a></li>
        <li class="dropdown mx-2 flex-fill text-center">
            <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">База данных</a>
            <ul class="dropdown-menu">
                <li><button id="DBadd" class="btn dropdown-item">Загрузить базу данных</button></li>
                <li><button id="DBout" class="btn dropdown-item">Выгрузить базу данных</button></li>
            </ul>
        </li>
    </ul>
</nav>
<section class="u-clearfix u-section-1" id="sec-64ce">
    <div class="container">
        <!-- Форма редактирования автора -->
        <form id="author-edit-form" class="u-clearfix u-form-spacing-10 u-form-vertical u-inner-form">
            <!-- ФИО (обязательное) -->
            <div class="u-form-group">
                <label for="name" class="u-label">ФИО</label>
                <input type="text" placeholder="Введите ФИО автора" id="name" name="name" class="u-input" required pattern="[A-Za-zА-Яа-яЁё0-9\s\-]+" title="Разрешены буквы, цифры, пробелы и дефис (-)">
            </div>
            <!-- Дата рождения (не обязательное) -->
            <div class="u-form-group">
                <label for="publicationYear" class="u-label">Дата рождения</label>
                <input type="date" id="publicationYear" name="birthday" class="u-input-number">
            </div>
            <!-- Страна (не обязательное) -->
            <div class="u-form-group">
                <label for="contry" class="u-label">Страна</label>
                <input type="text" placeholder="Введите страну" id="contry" name="contry" class="u-input" pattern="[A-Za-zА-Яа-яЁё0-9\s\-]+" title="Разрешены буквы, цифры, пробелы и дефис (-)">
            </div>
            <!-- Псевдоним (не обязательное) -->
            <div class="u-form-group">
                <label for="Nickname" class="u-label">Псевдоним</label>
                <input type="text" placeholder="Введите псевдоним автора" id="Nickname" name="nickname" class="u-input" pattern="[A-Za-zА-Яа-яЁё0-9\s\-]+" title="Разрешены буквы, цифры, пробелы и дефис (-)">
            </div>
            <!-- Кнопки -->
            <div class="buttons-container">
                <button type="submit" class="u-btn u-btn-submit">Редактировать</button>
                <a href="Страница-авторов.html" class="u-btn u-btn-cancel">Отмена</a>
            </div>
            <!-- Сообщения об отправке -->
            <div class="u-form-send-message u-form-send-success">Спасибо! Автор обновлен.</div>
            <div class="u-form-send-error u-form-send-message">Отправка не удалась. Пожалуйста, исправьте ошибки и попробуйте еще раз.</div>
            <!-- Скрытые поля -->
            <input type="hidden" name="recaptchaResponse" value="">
            <input type="hidden" name="formServices" value="234d2f51-51fe-7107-fa98-0d7a5e49113d">
        </form>
    </div>
</section>
<footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-2f71">
    <div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">
            О вопросах и проблемах сообщать главному администратору или писать на почту
            <a href="mailto:GlobalMaster@book.com">GlobalMaster@book.com</a>
        </p>
    </div>
</footer>
<!-- Скрипты валидации и функциональности -->
<script>
    // Функция для получения параметра из URL
    function getParameterByName(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // Функция для получения данных автора по ID и заполнения формы
    function fetchAuthorData(authorId) {
      fetch(`/api/authors/${encodeURIComponent(authorId)}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Автор не найден');
          }
          return response.json();
        })
        .then(author => {
          populateForm(author);
        })
        .catch(error => {
          console.error('Ошибка при загрузке данных автора:', error);
          alert('Не удалось загрузить данные автора.');
        });
    }

    // Функция для заполнения формы данными автора
    function populateForm(author) {
      // Обновление полей формы согласно существующим id
      document.getElementById('name').value = author.fio || '';
      document.getElementById('publicationYear').value = author.birthDate || '';
      document.getElementById('contry').value = author.country || '';
      document.getElementById('Nickname').value = author.nickname || '';
    }

    // Обработка отправки формы редактирования
    document.getElementById('author-edit-form').addEventListener('submit', function(event) {
      event.preventDefault();
      const authorId = getParameterByName('id');
      if (!authorId) {
        alert('ID автора не указан.');
        return;
      }
      // Собираем данные из формы, используя корректные id
      const authorData = {
        id: authorId,
        fio: document.getElementById('name').value.trim(),
        birthDate: document.getElementById('publicationYear').value,
        country: document.getElementById('contry').value.trim(),
        nickname: document.getElementById('Nickname').value.trim()
      };
      // Отправляем PUT-запрос для обновления автора
      fetch(`/api/authors/${encodeURIComponent(authorId)}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(authorData)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Ошибка при обновлении автора');
        }
        return response.json();
      })
      .then(data => {
        // Отображаем сообщение об успешном обновлении
        const successMsg = document.querySelector('.u-form-send-success');
        successMsg.style.display = 'block';
        setTimeout(() => {
          successMsg.style.display = 'none';
        }, 3000);
      })
      .catch(error => {
        console.error('Ошибка:', error);
        // Отображаем сообщение об ошибке
        const errorMsg = document.querySelector('.u-form-send-error');
        errorMsg.style.display = 'block';
        setTimeout(() => {
          errorMsg.style.display = 'none';
        }, 3000);
      });
    });

    // При загрузке страницы извлекаем ID автора из URL и запрашиваем его данные
    document.addEventListener('DOMContentLoaded', function() {
      const authorId = getParameterByName('id');
      if (!authorId) {
        alert('ID автора не указан в URL.');
        return;
      }
      fetchAuthorData(authorId);
    });
</script>
</body>
</html>
